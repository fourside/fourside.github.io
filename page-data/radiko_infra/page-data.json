{"componentChunkName":"component---src-templates-blog-post-js","path":"/radiko_infra","result":{"data":{"site":{"siteMetadata":{"title":"fourside.github.io"}},"contentfulBlogPost":{"title":"radiko 録音環境","updatedAt":"2020/09/01 15:37:08 +00:00","body":{"childMarkdownRemark":{"excerpt":"さくらVPSを借りてradikoの録音環境を用意していたんだけど、今年の4月くらいから録音ができなくなっていた。今更だけど確認してみると、 がOSAKAになってたので、東京の放送局が聴取できない状態だった。radikoの仕様変更じゃなかったので一安心。 まずawsの東京リージョンでt2.micro…","html":"<p>さくらVPSを借りてradikoの録音環境を用意していたんだけど、今年の4月くらいから録音ができなくなっていた。今更だけど確認してみると、<code class=\"language-text\">curl https://radiko.jp/area</code> がOSAKAになってたので、東京の放送局が聴取できない状態だった。radikoの仕様変更じゃなかったので一安心。</p>\n<p>まずawsの東京リージョンでt2.microインスタンスを作った。OSはamazon linux。radikoのエリア判定はTOKYOだったのでこれでよし。鍵はawsが生成したもの、インバウンドはsshとhttpのみ、さらにマイIPアドレスから許可するように、screenとvimのrcファイルを用意した。</p>\n<p>あとは必要なものをビルドするだけ。</p>\n<h3>必要なもの</h3>\n<ul>\n<li><a href=\"https://rtmpdump.mplayerhq.hu/\">rtmpdump</a></li>\n<li><a href=\"http://www.swftools.org/download.html\">swftools</a></li>\n<li><a href=\"https://www.ffmpeg.org/download.html\">ffmpeg</a></li>\n</ul>\n<h3>前準備</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> <span class=\"token function\">git</span>\nyum groupinstall <span class=\"token string\">\"Development Tools\"</span></code></pre></div>\n<h3>rtmpdump</h3>\n<p>オフィシャルの通り、<code class=\"language-text\">git clone git://git.ffmpeg.org/rtmpdump</code> する。READMEを見るとconfigureしなくてよいみたい。<code class=\"language-text\">make SYS=posix &amp;&amp; make install</code>した。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># rtmpdump -v\nrtmpdump: error while loading shared libraries: librtmp.so.1: cannot open shared object file: No such file or directory</code></pre></div>\n<p>soが読めてないっぽい。ビルドしたsoは<code class=\"language-text\">/usr/local/lib</code>にインストールされてる。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># cat /etc/ld.so.conf\ninclude ld.so.conf.d/.conf\n# echo /usr/local/lib &gt; /etc/ld.so.conf.d/rtmpdump.conf\n# ldconfig</code></pre></div>\n<p>cf. <a href=\"https://blogs.yahoo.co.jp/mrsd_tangerine/40359620.html\">https://blogs.yahoo.co.jp/mrsd_tangerine/40359620.html</a></p>\n<h3>swftools</h3>\n<p>最新のtarballを落としてくる。configure, make, make installですんなりいけた。(さくらVPSで使ってたdebianでは苦労した印象あったけど曖昧）</p>\n<h3>ffmpeg</h3>\n<p>すっかり忘れてたんだけど旧環境ではlameを使ってて、それをconfigure時に指定してやる必要がある。（指定しなくてもビルドはできるけど、ここでやりたいのはflvからmp3にエンコードすることなので）</p>\n<p><a href=\"http://lame.sourceforge.net/download.php\">lame</a>から落としてくる。configure, make, make installですんなりビルドできる。soは/usr/local/libに吐かれる。\nこのあとffmpegのビルド。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># configure --enable-libmp3lame --disable-x86asm\n# make\n# make install</code></pre></div>\n<h3>以上</h3>\n<p>こんな感じでした。</p>"}}}},"pageContext":{"slug":"radiko_infra","previous":{"body":{"body":"contentful web console sucks coz vim-vixen not work"},"title":"contentful test2","slug":"contentful_test_2","updatedAt":"2020-09-01T06:28:13.635Z"},"next":{"body":{"body":"今までメモはローカルに溜めていて、マシンの買い替えなんかが起きるとめんどくさくて、そのせいでDropboxが必須になってしまっていたり、自宅でやったことを職場で確認したいだとかは基本的に困難なので、ブログとして公開することにした。\n\n### 構成要素と理由\n\n- [GitHub Pages][GitHub Pages]\n- [jekyll][jekyll]\n- on WSL\n\nはてなやMediumでもよいんだろうけどソーシャルな機能はいらないし、tech系の話だったらgithubアカウント上でやったほうがいいかな程度の理由。テキストが手元に残るのもよい。\n\nあと最近、自宅のマシンをWindows10にしたこともあって、WSLだったらWindows上でrubyの開発環境を整えることに苦労しなくなると思った。cmd.exeからbashと打つだけでlinuxの世界になるのはすごい楽。ただrubyのビルドにえらい時間がかかったので途中で諦め、パッケージマネージャからインストールすることにした。バージョンはちょい古めだけど、nokogiriがすんなり入るのはうれしい。\n\n### 手順\n```\n$ sudo apt-get install ruby ruby-dev zlib1g-dev\n$ ruby -v\nruby 2.3.1p112 (2016-04-26) [x86_64-linux-gnu]\n$ gem install jekyll jekyll-feed minima\n$ jekyll -v\njekyll 3.6.2\n$ jekyll new fourside.github.io\n```\n\nzlibの1gってなんだろうね。\n\n### はまりどころ(未解決)\nWSL(Ubuntu)でrootだと日本語が表示できない。標準ユーザだとできる。envコマンドの差分を見たけど影響しそうなところがないように見える。どこに差があるのか分からない。ターミナルに弱い。\n\n### めんどくさいところ\npostするときにいっぱつでテンプレートを開きたい。ファイル名`yyyy-mm-dd-{title}.md`なんて手で打ちたくないし、ファイルの中身に作成日時まで入れなくちゃいけない。jekyllのコマンドにあってよさそうだけど、ぱっと見ない。\n\nvim pluginを探すか、これくらいなら自分で作ってみようかなという気持ちになっている。\n\n[GitHub Pages]: https://pages.github.com/\n[jekyll]: https://jekyllrb-ja.github.io/\n"},"title":"blog 環境","slug":"github_pages_jekyll","updatedAt":"2020-09-01T15:39:12.120Z"}}},"staticQueryHashes":["2390137347","3000541721"]}