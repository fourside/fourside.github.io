{
    "componentChunkName": "component---src-pages-index-tsx",
    "path": "/",
    "result": {"data":{"site":{"siteMetadata":{"title":"fourside.github.io"}},"contentful":{"edges":[{"node":{"title":"ghコマンドをupdateしたい","slug":"upgrade_gh","body":{"body":"日頃から [ghコマンド](https://github.com/cli/cli \"cli/cli: GitHub’s official command line tool\") にお世話になっていまして、PR作ったり、ターミナルからリポジトリをブラウザで開くのに使ったりしているのですが、不意にバナーが出ることで新バージョンがリリースされたことを知ります。そうするとGitHubのcli/cliリポジトリのReleaseページに行き、該当するバイナリを目で選んでダウンロードし、パスに通す。という手間をやっていたのですが、流石に手作業が多すぎると思い、簡単なスクリプトを書きました。\n\n`gist:fourside/ef69da72c47779591ee9ab23af096ea4`\n\n今までちゃんと調べないで使ってたせいで、知らないオプションがいろいろありました。\n\n- `-R` オプションでカレントディレクトリ以外のリポジトリが参照できる\n- JSONのフォーマットで出力できて、さらにjqのような絞り込みができる\n\nupdateサブコマンドの実装案とかissueにないか探してたら、オフィシャルの案内ではパッケージマネージャ経由でバージョンをあげろということみたいですね…。","childMarkdownRemark":{"excerpt":"日頃から ghコマンド にお世話になっていまして、PR作ったり、ターミナルからリポジトリをブラウザで開くのに使ったりしているのですが、不意にバナーが出ることで新バージョンがリリースされたことを知ります。そうするとGitHubのcli/cliリポジトリのRelease…"}},"publishDate":"2022/01/26"}},{"node":{"title":"「クラウド破産を回避するIaC実践ガイド」を読んでCDKで再実装しました","slug":"cloud_bankruptcy_iac","body":{"body":"- [クラウド破産を回避するInfrastructure as Code実践ガイド - KOS-MOS - BOOTH](https://booth.pm/ja/items/2366365)\n    - 技術書典9で見つけました\n    - AWSアカウントをセキュアに使うために、それ用のAWSリソースをTerraformで作成しようという内容\n\n### 動機\n- 全くノーガードだったものの、ちゃんとしたい気持ちは常にあった\n    - [AWSアカウントを作ったら最初にやるべきこと ～令和元年版～ | Developers.IO](https://dev.classmethod.jp/articles/aws-1st-step-new-era-reiwa/)\n        - こういうのもブックマークして積んだままになってた\n        - 開発に *直接* 関係しない部分だし…\n    - とはいえ、毎月AWSにお金を払っているのだし、最低限のことはやっておきたい\n\n### やったこと\n- Terraformで作成されているのを、AWS CDKで再実装\n    - CDKの勉強にもなるし\n    - 主に10章から18章、22章を対象にした\n    - 作ったリソースは以下の通り\n        - CloudTrail / AWS Config / GuardDuty / IAM Access Analyzer / Security Hub / Chatbot\n        - これらに S3 / IAM / SNS らへんを連携させる\n        - 22章では、月額の利用料金をSlack通知する Lambda Function を作成\n- 作成したものはこちら\n  - [fourside/cloud-bankruptcy](https://github.com/fourside/cloud-bankruptcy)\n\n### やってみて\n- IAMロールらへんの理解が曖昧だったのが、 *少し* 理解が進んだ\n- AWS Config の料金が意外とかかる\n    - ビジネスで使うなら微々たるものかもだけど、対象ルールが200弱で 1.9 USD/月 くらいになった\n    - 逆にいうと、ほかはほとんどかからないのでやっておくのが得\n- よくわからないタイミングでGuardDutyから通知がきて怖い…\n    - Severity: LOW なので放置してしまっているが…\n    - とはいえ、ちょっとしたことでも通知が来ることによる安心感のほうが大きい\n- 利用料金のSlack通知が便利\n    - 「普段ならこれくらいなのに、今月の予測値が高い」みたいな状況に気付ける\n        - 後始末してなかったEC2リソース(インスタンスやElasticIP)があることに気づけた\n","childMarkdownRemark":{"excerpt":"クラウド破産を回避するInfrastructure as Code実践ガイド - KOS-MOS - BOOTH 技術書典9で見つけました AWSアカウントをセキュアに使うために、それ用のAWSリソースをTerraform…"}},"publishDate":"2020/11/05"}},{"node":{"title":"XML Parserの比較","slug":"compare_xml_parsers","body":{"body":"- radikoのxmlをjsonにパースしたくて、npmモジュールの比較をしてみました\n- 前提\n  - ランタイムは Node.js で、ブラウザでの実行は考慮しない\n  - パースの実行頻度はそれほど高くないので、実行速度は気にしない\n  - コンテナに乗せる可能性はある（ファイルサイズやインストールの速度は気にする）\n- 対象はこの3つにした\n    - [xml2js - npm](https://www.npmjs.com/package/xml2js)\n    - [xml2json - npm](https://www.npmjs.com/package/xml2json)\n    - [fast-xml-parser - npm](https://www.npmjs.com/package/fast-xml-parser)\n- 比較したときのコードはこれ\n    - [fourside/choice\\_xml\\_parsers](https://github.com/fourside/choice_xml_parsers)\n\n### TL;DR\n- 悩むけど fast-xml-parser がよさそう\n  - 次点で xml2js\n\n### 比較の軸\n- npm trends\n- 型情報の有無\n- 使用感\n- 出力の比較\n\n### npm trends\n[xml2json vs fast xml parser vs xml2js | npm trends](https://www.npmtrends.com/xml2json-vs-fast-xml-parser-vs-xml2js)\n\n- xml2jsがGitHub starもダウンロード数も圧倒的に多い\n- ファイルサイズも xml2js が小さい\n\n### 型情報の有無\n- fast-xml-parserは自身の型定義を提供してくれている\n- それ以外の2つは@types パッケージがある\n\n### 使用感\n- xml2js\n    - プロミス用のメソッドがあり、若干野暮ったい(`parseStringPromise`)\n- xml2json\n    - インストール時にローカルビルドが走る\n    - パースの結果がJSONの文字列で、`JSON.parse` する必要がある\n- fast-xml-parse\n    - 特になし\n\n### 出力の比較\n\n- 入力は以下のようなラジオ局一覧の xml\n- 結論、出力に関しては、オプション次第でどれも使いやすいJSONが得られる\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<stations area_id=\"JP13\" area_name=\"TOKYO JAPAN\">\n  <station>...</station>\n  <station>...</station>\n</stations>\n```\n\n#### xml2js\n\n- 属性はフラットに表現されるのではなく、オブジェクトとしてまとめて表現される\n    - フィールド名はオプションで変更可能\n- テキストノードはデフォルトで配列で表現されるが、オプションで変更可能\n\n```json\n{\n  \"stations\": {\n    \"attr\": {\n      \"area_id\": \"JP13\",\n      \"area_name\": \"TOKYO JAPAN\"\n    },\n    \"station\": [...]\n  }\n}\n```\n\n#### xml2json\n\n- 特にオプションの指定なく、分かりやすいJSONが得られた\n    - ただしオプションは他の2つに比べて粗い\n- 属性はフラットに親フィールドにぶら下がる（ので、xmlの属性であったかどうかは不可逆）\n\n```json\n{\n  \"stations\": {\n    \"area_id\": \"JP13\",\n    \"area_name\": \"TOKYO JAPAN\",\n    \"station\": [...]\n  }\n}\n```\n\n#### fast-xml-parser\n\n- デフォルトで属性を無視ってきたので驚いたが、オプションで制御可能\n- 属性はフラットに親フィールドにぶら下がる\n    - ただしフィールド名にサフィックスをつけることができる（オプションで空文字を指定することもできる）\n- 下記の出力例には現れてないが、数値のノードはJSONでも数値として表現される（上記2つは `\"1\"` のように文字列になる)\n\n```json\n{\n  \"stations\": {\n    \"area_id\": \"JP13\",\n    \"area_name\": \"TOKYO JAPAN\",\n    \"station\": [...]\n  }\n}\n```\n\n### おわりに\n他に良さそうなのがあれば教えてください","childMarkdownRemark":{"excerpt":"radikoのxmlをjsonにパースしたくて、npmモジュールの比較をしてみました 前提 ランタイムは Node.js…"}},"publishDate":"2020/10/21"}},{"node":{"title":"JSON から SQL を生成しました","slug":"json_to_sql","body":{"body":"- [fourside/sqlgen-cli](https://github.com/fourside/sqlgen-cli)\n\n### なにをするやつ\n- JSON から INSERT 文や DELETE 文を出力します\n\n### なぜ作ったのか\n- 元ネタは過去にやった案件で、簡単に書いたテストのヘルパーの焼き直し\n    - テスト用のデータの作成\n    - たまたま MySQL だったので、bulk insert の形にしている\n    - cliの形式を取ってはいるけど、完全に自分用であまり柔軟には作っていない\n- 難しいことは一切していない\n    - 外部参照制約での値の決定とか…\n    - DELETE 文も参照関係を考慮していないので、INSERT 文を生成してる順番を逆にしてるだけ\n- TypeScriptファイルにJSON定義しているので、デフォルト値や日時の生成など動的に値を決定できるのが便利ポイント\n- わざわざ書き直したのは、触ったことのないライブラリを使ってみたいというモチベーションもある\n    - いずれもちょろっとしか触れてないので、そんなに何か言えることはない…\n\n#### [dayjs](https://github.com/iamkun/dayjs)\n- 軽量、Dateのprototypeも汚染しない、npm trendsみても結構流行ってる\n- utcが素のままで使えなかったのは少し驚いたけども、デフォルトで入ってるプラグインを通せば大丈夫\n- 型定義も元から入ってるの安心感ある\n\n#### [yargs](https://github.com/yargs/yargs)\n- cli parserのcommanderは以前使ったことがあったので、別のやつ\n- 悪くない、次どっち使うかは迷う\n\n#### [ava](https://github.com/avajs/ava)\n- 年末のsurveyとかで見かけるテストライブラリ\n- jestだとリッチすぎるかなーというときmochaを選ぶけど、これでもよさそうな感じはする\n- TypeScriptで使うとき [多少の設定](https://github.com/avajs/ava/blob/master/docs/recipes/typescript.md) が必要だった\n\n以上です。\n","childMarkdownRemark":{"excerpt":"fourside/sqlgen-cli なにをするやつ JSON から INSERT 文や DELETE 文を出力します なぜ作ったのか 元ネタは過去にやった案件で、簡単に書いたテストのヘルパーの焼き直し テスト用のデータの作成 たまたま MySQL だったので、bulk…"}},"publishDate":"2020/09/28"}},{"node":{"title":"Redux Toolkitの感想","slug":"redux_toolkit","body":{"body":"これです\n- [Redux Toolkit | Redux Toolkit](https://redux-toolkit.js.org/)\n\n### なぜ使おうと思ったか\n- この辺を読んで「入れてもいいかな」から「やってみよう」になった(なるべくデフォルトで作って余計なものを入れたくない気持ちが邪魔をしていた)\n    - [TypeScriptでReactをやるときは、小さいアプリでもReduxを最初から使ってもいいかもねというお話 | フューチャー技術ブログ](https://future-architect.github.io/articles/20200501/)\n    - [りあクト！ TypeScriptで始めるつらくないReact開発 第3版【Ⅲ. React応用編】 - BOOTH](https://oukayuka.booth.pm/items/2367992)\n- Redux + TypeScript だと確かにコード量が多くなり、自分のアプリケーションでもアクションの型定義で200行近く、アクション自体で300行超だったので見通しが悪かった\n\n### 進め方\n- Redux Toolkit に tutorial があるのでそれを読んで、実際にコードの置き換えをしていくだけ\n    - [Basic Tutorial | Redux Toolkit](https://redux-toolkit.js.org/tutorials/basic-tutorial)\n    - Basic => Intermediate => Advanced と段階があるけど、Advanced までやらないと非同期の処理が出てこないので最後までやる\n- redux toolkit をインストールすると、redux/redux-thunk が一緒に入ってくるので、最初から toolkit を使うのが便利かもしれない（ただし redux のバージョンがちょっとだけ古い）\n\n### 結果\n- 実際にコード量が減った\n    - https://github.com/fourside/filmemo/pull/29\n        - `+586 -790`\n    - slice (action + reducer なオブジェクト)を作ると、action creator を用意せずに済むのがうれしい\n    - 結果 actions.tsとその型情報を全部消せた\n- コードの見通しがよくなった\n    - reducer は reducer.ts に、 action は actions.ts に、というようにしていたところ、子の state 毎に features/xxx といったディレクトリを切って、そこに reducer/action を収めるようにした\n    - tutorial の通りに進めると、ある程度自然と [Redux の Style Guide](https://redux.js.org/style-guide/style-guide) の通りになるので安心感がある\n        - この安心感のおかげで、redux に対するうっすら苦手意識みたいなのはなくなった\n- 使った API は `createSlice` `configureStore` くらいで、簡単に導入できる\n    - あとで `createSelector` も触っておく\n\n### 悩んだところ\n\n#### reducer の中で state を mutate してるかのようなコードを書くこと\n- [Intermediate Tutorial | Redux Toolkit](https://redux-toolkit.js.org/tutorials/intermediate-tutorial#mutable-update-logic)\n    - redux toolkit の中で immer.js を使っており、実際には mutate しない動作になるとのこと\n    - 通常の reducer では更新しない項目まで面倒みないといけないので、意図が分かりにくいコードになる\n- 知らないとびっくりされそうなポイントだなと思ったが…\n    - redux toolkit のAPIに渡すものの中でやることなので、一度知ってしまえば混同することはなさそう\n\n#### 非同期なアクション(thunk action)の戻り値が欲しいときがある\n- dispatch(someAsyncAction()) は promise を返すわけではなし、reduxの管理するstateから実行結果を得るしかない\n- containerをかませればできるのだけど、できれば redux の hooks を使いたい\n- 以下、個別のケースを2つ\n\n##### 認証のリダイレクト後に未認証、認証のチェックをしたい\n- 未認証ならサインイン画面に飛ばすとかやりたいんだけど、初期値の状態を経て認証状態になるので、単純に任意の値がfalsyかどうかで判断できない\n- `authed | unauthed | unknown` みたいな3値で判定するようにした(ここでの unknown は、SQL での null は未定を意味するみたいな発想)\n\n##### form送信して成功/失敗のチェック\n- 成功したら画面遷移などさせたいし、失敗したら留まって欲しい\n- 結果を redux で管理する？\n    - だとして、結果をクリアするタイミングとかエンバグしそうな箇所を作りたくない\n- とりあえず、成功時の処理をコールバックとして thunk action に渡すようにした\n    - これはあんまりよくないやり方だと思う…ので、thunk action を使わず、カスタムフックを作ってそこでプレーンなアクションを dispatch するのがきれいなように思える\n\n### 最後に\nbundle サイズどれだけ変わったか。\n\n```bash\nFile sizes after gzip:\n\n  241.45 KB (+6.08 KB)  build\\static\\js\\4.d246d372.chunk.js\n  54.38 KB (+11 B)      build\\static\\js\\5.c7a89df4.chunk.js\n  9.4 KB (-3 B)         build\\static\\js\\0.cba94f39.chunk.js\n  6.04 KB (+164 B)      build\\static\\js\\main.b9447786.chunk.js\n  3.07 KB (+5 B)        build\\static\\js\\6.b4b32cf6.chunk.js\n  3.05 KB (-19 B)       build\\static\\js\\8.f62b749c.chunk.js\n  2.35 KB (+6 B)        build\\static\\js\\7.be5a358d.chunk.js\n  1.23 KB (+1 B)        build\\static\\js\\runtime-main.681aaec9.js\n  731 B (-1 B)          build\\static\\js\\1.816b4f1d.chunk.js\n  443 B (+3 B)          build\\static\\js\\9.1e585942.chunk.js\n  304 B                 build\\static\\css\\main.ed9b3d4b.chunk.css\n```\n\nおおよそ6KBの増加。これを許せるかどうかはプロジェクトに依るだろうな。とはいえ保守性に関わるのでできれば使いたいなと思います。\n","childMarkdownRemark":{"excerpt":"これです Redux Toolkit | Redux Toolkit なぜ使おうと思ったか この辺を読んで「入れてもいいかな」から「やってみよう」になった(なるべくデフォルトで作って余計なものを入れたくない気持ちが邪魔をしていた) TypeScriptでReact…"}},"publishDate":"2020/09/25"}},{"node":{"title":"Intersection Observer API でサイドメニューの状態変化","slug":"intersection_observer_api","body":{"body":"### 作ったもの\n- [fourside/vanila_scroollspy](https://github.com/fourside/vanila_scroollspy)\n![intersection observable api](//images.ctfassets.net/2zg7j2cy03uu/6Sdv5J3zHP2mead2qgs0q7/081957eaf3b8b3d08f89c343910ece57/intersection_observable_api.gif)\n\n### モチベーション\n- Intersection Observer API を使う処理の素振り\n- サイドメニューの expand / collapse を実装してみた\n- Infinity Scroll の場合は以前試したことがある\n    - [filmemo/useIntersect.ts](https://github.com/fourside/filmemo/blob/develop/src/hooks/useIntersect.ts)\n\n### 参照\n- [Intersection Observer API - Web API | MDN](https://developer.mozilla.org/ja/docs/Web/API/Intersection_Observer_API)\n- [JSでのスクロール連動エフェクトにはIntersection Observerが便利 - ICS MEDIA](https://ics.media/entry/190902/)\n    - オプションについての説明が分かりやすい\n    - やりたかったこと全部ここにあるのよね…\n\n### 素振りについて\n- こういった素振りをする行為は大事だなと思っていて、ちょっと前にやった案件でモーダルを出したくなったとき、以前バニラでモーダル実装したことがあったので、さっと作ることができた\n- なんとなくAPIを知っているくらいの状態だと、いざ必要になったときに調査のフェーズが挟まるし、見積もりも余計にバッファを積んでしまう\n- 一回自分で作っておくと、これくらいの実装で可能だというのが分かるし、最低でも記憶のインデックスになる\n    - 他のライブラリに依存しないで作れると他の環境でも応用しやすい\n- 今回のは CSS アニメーションに手こずったけれどもね…\n","childMarkdownRemark":{"excerpt":"作ったもの fourside/vanila_scroollspy intersection observable api モチベーション Intersection Observer API を使う処理の素振り サイドメニューの expand / collapse…"}},"publishDate":"2020/09/09"}},{"node":{"title":"郵便番号検索APIを作った","slug":"postalcode_search","body":{"body":"- [fourside/postalcodesearch](https://github.com/fourside/postalcodesearch)\n\n```bash\n$ curl -s https://xxxxxxxxxx.execute-api.ap-northeast-1.amazonaws.com/prod/addresses/1000001 | jq .\n[\n  {\n    \"zipcode\": \"1000001\",\n    \"address1\": \"東京都\",\n    \"address2\": \"千代田区\",\n    \"address3\": \"千代田\",\n    \"kana1\": \"とうきょうと\",\n    \"kana2\": \"ちよだく\",\n    \"kana3\": \"ちよだ\"\n  }\n]\n```\n\n- 元になるデータは [zipcloud の加工済み csv ファイル](http://zipcloud.ibsnet.co.jp/) を使った。ありがたく使わせてもらっています\n  - zipcloud でも　WebAPI を公開してるのだけどなるべく自前でホストしたいと思って実装した\n\n### 構成\n- いわゆるサーバレス\n- aws-cdk\n    - Lambda Function\n    - API Gateway\n    - DynamoDB\n- ちょこちょこ考えなきゃいけないところがあったのでメモしていきます\n\n### DynamoDB のテーブル設計\n- 「データをどう使うか」から設計を始める\n- 郵便番号をキーに検索するので、パーティションキーは郵便番号にする\n- ただし郵便番号はユニークではない。ひとつの郵便番号に複数の住所が紐付くパターンがある\n- ソートキーが必要になるが、ふさわしい CSV のカラムはない\n    - 住所1や住所2だと重複するし、住所3だと空文字になる\n    - 住所1、住所2、住所3を連結して、ソートキーとした\n    - それでさえ重複するケースがあるので、データ投入時にパーティションキー + ソートキーでユニークにする必要がある\n        - 例: 0741273 北海道 深川市 音江町\n\n### データ投入\n- `cdk deploy` にからめて実行できればと考えたけど、何度も実行する必要はないのでコマンドを分けた\n- データ量は、ざっくり13万件弱\n- [BatchWriteItem](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_BatchWriteItem.html)\n    - 一度に複数レコードを書き込める API を使う\n    - ただし25件が上限で、超えると次のエラーメッセージ\n        - `Member must have length less than or equal to 25, Member must have length greater than or equal to 1`\n        - 上記ドキュメントにもちゃんと書いてあったね…\n        - 13万件 / 25件 で、5200回のリクエストを発行することになる\n- DynamoDBのテーブルの Billing mode をプロビジョニング済み(cdkでのデフォルト)にすると途中で失敗する\n    - `ProvisionedThroughputExceededException: The level of configured provisioned throughput for the table was exceeded. Consider increasing your provisioning level with the UpdateTable API.`\n    - オンデマンドにすること\n- DynamoDBに空文字は登録できないので、null に置き換えること\n- 元データは Shift_JIS なので、UTF-8 に変更すること\n\n### misc\n- Node.js でのファイルシステムのアクセスで、Stream API を使ってみた\n    - 一度にメモリに読み込むより省メモリでよいかと思ったけど、結局読み込んでからユニークにする処理を入れたりで、あんまり意味がなかった…\n- 元々のモチベーションとして、決済機能を補助するものとして作っていて、今回はそのリファインしたもの\n    - amplify 内の Lambda Function で実装していて、src ディレクトリ内をごっそりデプロイする形だったので、Lambda から csv を直接読むような形にしていた\n        - csv は未ソートだし、ファイルサイズは大きいしで、HTTPリクエスト時にファイル内検索するのはレスポンスが遅くなりすぎる\n        - よって csv を事前にソートし、さらに郵便番号の頭2桁をキーにファイル分割するようにした\n        - 今考えるとちょっと雑だったかな…\n","childMarkdownRemark":{"excerpt":"fourside/postalcodesearch 元になるデータは zipcloud の加工済み csv ファイル を使った。ありがたく使わせてもらっています zipcloud でも　WebAPI…"}},"publishDate":"2020/09/08"}},{"node":{"title":"aws-cdk の aws-lambda-nodejs で puppeteer を動かす","slug":"aws_cdk_lambda_nodejs_puppeteer","body":{"body":"- 作ったものはこれ\n    - [fourside/meigaza](https://github.com/fourside/meigaza)\n        - 映画の情報をスクレイプして、 Slack や IFTTT 経由 でモバイル通知する Lambda Function\n    - aws-cdk で Lambda とその周辺の リソースを定義した\n\n### aws-cdk\n- AWSのリソースをコードで表現できるフレームワーク\n- TypeScript で書ける\n    - コード補完が効いてうれしい\n    - パーミッションなどデフォで設定されるので細々定義しなくてよい\n    - CloudFormation で yaml 書くのはつらかった…\n- [What is the AWS CDK? - AWS Cloud Development Kit (AWS CDK)](https://docs.aws.amazon.com/cdk/latest/guide/home.html)\n    - `Getting started` とか読んだ\n- [aws-lambda-nodejs module](https://docs.aws.amazon.com/cdk/api/latest/docs/aws-lambda-nodejs-readme.html) が便利\n    - まだ experimental な状態で、さらに semver を採用してない\n    - Lambda のソースコードが TypeScript で書ける\n    - [aws-lambda module](https://docs.aws.amazon.com/cdk/api/latest/docs/aws-lambda-readme.html) だと、CDK 部分は ts、Lambda 本体は common js になって、eslint しにくかったりコンテキストスイッチが発生したりで体験がよくない（eslint はディレクトリ毎に設定ファイルを置いても vs code が認識してくれなかった）\n        - なので experimental でも使う…\n\n### puppeteer を動かす\n- [chrome-aws-lambda](https://github.com/alixaxel/chrome-aws-lambda) を [Lambda Layer](https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_aws-lambda.LayerVersion.html) に含める\n- cdk deploy 時に layer のアセットを作るには以下を参考にした\n    - [AWS CDK を使って node_modules を AWS Lambda Layers にデプロイするサンプル | Developers.IO](https://dev.classmethod.jp/articles/aws-cdk-node-modules-lambda-layer/)\n    - 簡単にいうと、 `bin/{appName}.ts` がスタックを作る前に Layer のアセットとなる資材を作っておく\n- `cdk deploy`, `cdk synth` の度に Layer の元を作るのもコストが大きいので（具体的には`npm install`)、もとになる package-lock.json のハッシュ値を比較して作る作らないを制御するようにした\n\n### aws-lambda-nodejs でローカルでビルドするときのコツ\n- [aws-lambda-nodejs - Local bundling](https://docs.aws.amazon.com/cdk/api/latest/docs/aws-lambda-nodejs-readme.html#local-bundling)\n    - parcel を install してると、バンドル時にそれを使ってくれる\n        - ただし [Windows だと無視されるので ](https://github.com/aws/aws-cdk/blob/v1.62.0/packages/%40aws-cdk/aws-lambda-nodejs/lib/bundlers.ts#L31) WSL を使う\n    - そうでなければ Docker が使われる\n- Lambda を複数定義するときは、parcelのキャッシュディレクトリは分ける\n- Layerに含める npm モジュールをバンドルしないようにする\n    - `externalModules` オプションに指定した npm は、[parcel の targets](https://github.com/parcel-bundler/parcel#targets) の `includeNodeModules` オプションに追加される\n\n### misc\n- cdk synth, cdk deploy 中は、package.json が汚れる\n    - Ctrl-Cなどで中断すると残ってしまう\n    - 具体的には parcel のビルドターゲット\n        - `includeNodeModules` には `{npmName}: false` という形で設定される\n        - parcelのドキュメントに記載されてない形なので、正しく動かないのではと思ってしまったけど、そんなことはなかった\n            - [Pull Request #4072 - parcel-bundler/parcel](https://github.com/parcel-bundler/parcel/pull/4072/files#diff-55ff0e36af2108f79d8af002e7dc6841)\n        - 現状、`externalModules` と `nodeModules` どちらに指定しても[結果は同じ](https://github.com/aws/aws-cdk/blob/v1.62.0/packages/%40aws-cdk/aws-lambda-nodejs/lib/bundling.ts#L131)\n- WSLでWindows側のディレクトリを使ってビルドすると遅い\n    - WSL側のファイルシステムを使う\n    - vs code は wsl extension を使う\n","childMarkdownRemark":{"excerpt":"作ったものはこれ fourside/meigaza 映画の情報をスクレイプして、 Slack や IFTTT 経由 でモバイル通知する Lambda Function aws-cdk で Lambda とその周辺の リソースを定義した aws-cdk AWS…"}},"publishDate":"2020/09/07"}},{"node":{"title":"Gatsby + Contentful on GitHub Pages","slug":"gatsby_contentful_gh_pages","body":{"body":"\nfourside.github.io を jekyll で構築していたけど、gatsby に鞍替えした。モチベーションは gatsby を触ってみたかったというくらい。\n\n### やったこと\n\nなるべくシンプルにしたかったので、オフィシャルのスターターである [gatsbyjs/gatsby-starter-blog](https://github.com/gatsbyjs/gatsby-starter-blog) を使った。とはいえSEOとかオフライン対応とかもろもろ入っているので便利。\n\n自分でカスタマイズしたのはこれくらい。移行元となるべく機能差異ないようにした（そんな機能もりもりじゃないけども…）。基本的にプラグインを入れて設定をするだけ。\n\n- 自分のアイコンは Gravatar からひっぱってきた\n- Gist を展開するようにした\n- RSS feedを吐くようにした\n- 自動でデプロイされるようにした\n\n自動デプロイについて。Contentful で publish したら走るようにした。 jekyllだと mdファイルをpushしたらGitHub Pagesが自動でビルドしてくれるが、Gatsby + Headless CMS だと、ビルド時に CMS から記事を取得しなくてはならない。具体的には Contentful Webhook と GitHub Actions の組み合わせ。Contentful で記事を操作したら GitHub API にリクエストが飛ぶようにする([Webhooks | Contentful](https://www.contentful.com/developers/docs/concepts/webhooks/))。GitHub Action で、そのリクエストが飛んできたらビルドとデプロイが走るようにする。\n\n~~デプロイは、[gh-pages](https://www.npmjs.com/package/gh-pages) を使うだけ。GitHub Pagesのブランチを `gh-pages` にしておいて、ビルド成果物だけを push する。~~ GitHub Actions では [peaceiris/actions-gh-pages](https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-first-deployment-with-github_token) を使うようにした（直接 gh-pages を使うと `fatal: empty ident name (for <runner@fv-az60.xxxxxxxxxxxxxxxxxxxxxxxxxx.cx.internal.cloudapp.net>) not allowed` なんて怒られてしまう。これには workflow 内で自動生成される GITHUB_TOKEN が必要らしいのだけど、便利な action ([peaceiris/actions-gh-pages](https://github.com/peaceiris/actions-gh-pages))があるので使わせてもらった。）\n\nGitHub Actions のドキュメントは以下を参照した。日本語版だとデッドリンクがあったりURLのフラグメントが設定されてなかったりする。余談だけどドキュメントの規模が大きくなったとき、一部だけ見て理解できるようにコンテキストを少なくして作成できたらいいだろうなと思うものの、もともとボリュームが大きいのでできるだけスリムに書きたいとも思うし、塩梅は難しいな。\n\n- [Events that trigger workflows - GitHub Docs](https://docs.github.com/en/actions/reference/events-that-trigger-workflows#repository_dispatch)\n    - `repository_dispatch` イベントを発生させるとworkflowをキックできるみたい\n- [Repositories - GitHub Docs](https://docs.github.com/en/rest/reference/repos#create-a-repository-dispatch-event)\n    - 上記イベントを発生させる GitHub API\n- [Creating a personal access token - GitHub Docs](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token)\n    - 外部サイトの Webhook に与える認証について\n    - 一年で revoke されるっぽいので、ブログ更新を一年サボると動かなくなる\n    - 今回は repo > public_repo でよい\n    - その乗せ方\n        - [Resources in the REST API - GitHub Docs](https://docs.github.com/en/rest/overview/resources-in-the-rest-api#oauth2-token-sent-in-a-header)\n- [GitHub API v3 | GitHub Developer Guide](https://developer.github.com/v3/#user-agent-required)\n    - GitHub APIは、User-Agent ヘッダがないとエラーになるみたい。なんか適当なのを入れておく\n\n### misc\nそれぞれ触ってみての感想\n\n#### Headless CMS\nなんで Headless CMS にしたか。ローカルにファイル作ってもいいかとも思ったけど、知らないものは触っておくことにした。後付で理由も考えてみたけど…。\n\n- jekyllの場合\n    - ディレクトリやファイル名で記事のURLが決まる。面倒くさい\n    - リポジトリが手元にある必要がある\n- Headless CMSの場合\n    - Webフォームで入力する。そこまで面倒じゃない\n        - 画面開いてログインするのは面倒くさい\n    - ブラウザがあればpublishできるのでポータビリティはある\n    - Headless CMSのほうが記事を書くための心理的障壁が下がるかなと思う。\n\n#### Contentful\n- UIの分かりやすさはある。探してるものがすぐ見つかる\n    - 編集画面はちょっと狭くて好きではない\n    - publishDate、デフォで現在時刻を入れてて欲しい\n- Firefox だとコンソールにエラーがでまくってて、そのせいか vim-vixen が動かず、そこが不満ではある…\n- 他にもさらっと候補を調べてみたけどそこまで時間かけなくていいかと思った程度\n\n#### Gatsby\n- tutorial 分かりやすい。React を触ったことがあればすいすい進む\n- GraphiQL がついてくるので、クエリの結果を確かめるのが簡単\n- plugin をもりもり入れる\n  - gatsby-config.js が太るし、ここに Graphql のクエリを書く場合もあり、リッチなものを作ろうと思ったらつらくなりそう\n- Markdown ファイルと Contentful を併存させようとして遭遇したエラーがちょっと分かりにかった\n  - 結局 Markdown は Contentful に手作業で移行した…\n","childMarkdownRemark":{"excerpt":"fourside.github.io を jekyll で構築していたけど、gatsby に鞍替えした。モチベーションは gatsby を触ってみたかったというくらい。 やったこと なるべくシンプルにしたかったので、オフィシャルのスターターである gatsbyjs/gatsby…"}},"publishDate":"2020/09/02"}},{"node":{"title":"作ったものの説明","slug":"desc_repo","body":{"body":"- 今まで作ったものの説明をしてこなかったので簡単に説明しようと思います。\n- 就職活動でGitHubのURLを乗せても、READMEに書くのは簡単な説明と使い方くらいなので分かりにくいと思うので…。\n    - 主に「なぜ作るのか」、「何を学んだか」\n    - 基本的には、自分の問題を解決するため\n        - 次に、興味のあるライブラリなどを試すため\n\n## [ie-ignore-slide](https://github.com/fourside/ie-ignore-slide)\n- スライドのライブラリ\n- polyfill使えばいいのだけど完全に個人用なのでIEを無視することに\n\n#### 背景\n- パワーポイントを使いたくなさすぎて自作した\n\n#### 学んだ技術\n- WebComponents\n    - 当時ようやくFirefoxで使えるようになったのと、技術書典でWebComponentsの本を買ったことが理由\n\n#### 工夫\n- 地味にプログレスバーを用意してLTに便利なようにしてる\n\n#### 改善点\n- CSSアニメーションをもっとスライドらしくしたい\n- コンポーネントにあてるCSSをきれいに書けずもどかしい\n- npm publishしたほうが使いやすい\n\n## [podcast](https://github.com/fourside/podcast)\n\n- 録音したものをpodcast形式で配信するアプリケーション\n- だいぶ前に作っていて今でもずっと使い続けており、最近コンテナ化した\n\n#### 背景\n- ラジオが好きなので個人用のアーカイブ\n\n#### 学んだ技術\n- docker\n    - もともと素朴に作っていたものをコンテナ化した\n    - そうすることでミドルウェアの設定などもgitで管理できるようになり、ポータビリティが得られた\n    - logging driverでログ収集することでfluentdクライアント不要になるところがよい\n\n#### 工夫\n- docker-compose.ymlを開発用と本番用に分けたところ\n    - 本番用にはfluentd/mongodbを足して、ログの集積をしている\n\n#### 改善点\n- 集積したログを閲覧・検索したり、監視したりする仕組みを用意したい\n\n## [videoserver](https://github.com/fourside/videoserver)\n- youtubeから動画をダウンロードしてpodcastとして配信する\n\n#### 背景\n- テック系の動画を通勤中に見れるように\n- podcastとして管理すると未読管理が楽になる\n- 結局はmusic videoがメインになってしまった\n\n#### 学んだ技術\n- バックエンドはgolang\n    - goroutine, channelの基本的な使い方\n    - パッケージ管理はいろいろ変遷があったようだがdepを使うようにした\n    - ビルドにはmakeを使い、静的解析をするようにした\n- フロントエンドはreact\n    - 途中でhooksに書き換えてみたり、reduxに入門したりした\n    - ビルドツールはparcelにした\n        - 勝手に必要なものが裏で揃えられるので楽だけど、たまにうまく行かなくなるときがある…\n        - 小さく始めるときの最初のビルドツールとして最適だと思った\n    - web workerも使ってみた\n\n#### 工夫\n- polling処理でダウンロードの進捗表示をするところ\n    - バックエンドはgoroutineからyoutube-dlの標準出力を抜き取ってレスポンスを返す\n    - フロントエンドはWebWorkerでサーバリクエストを送り、メインスレッドにサーバレスポンスの一部を返す\n\n#### 改善点\n- 削除APIができていない\n    - DBを使ってない（ファイルシステムを直接見てレスポンスを作っている）ので、一意にしにくい\n- reduxを使い始めたが、きちんと理解した感じがしない\n    - ミドルウェアまで入れたくない気持ちがあるが実際はどうなのか\n- 字幕情報をダウンロードできるのだが、動画に埋め込むとき字幕表示がきれいではない\n\n## [meigaza](https://github.com/fourside/meigaza)\n- スクレイピング結果をslackやスマホに通知してくれるスクリプト\n\n#### 背景\n- 映画をよく見るようになった\n    - 東京にある名画座のスケジュールを簡単に知りたくなった\n    - 気づいたら前売り券を買える期間が過ぎていた\n\n#### 学んだ技術\n- puppeteerによるスクレイピング\n- aws lambdaのカスタムランタイム\n- iftttでの通知\n\n#### 工夫\n- 最初は常駐型のボットを実装しようと思ったが、スケジュールでキックされるAWS Lambdaで実現できたこと\n\n#### 改善点\n- cliでデプロイできるようにしたい\n\n## [mock-server](https://github.com/fourside/mock-server)\n- リクエストパスとサーバローカルのファイルをマッピングするサーバ\n\n#### 背景\n- フロントエンド(SPA)の開発でモックサーバが欲しくなった\n    - 特にページャの実装で、特定のクエリ文字列を含むURLのとき、それっぽいJSONを返してほしい\n    - nginxのlocationはクエリまで含めて判定してくれない\n    - 軽く探しても欲しい物はなさそうだったので、自分で書くことにした\n\n#### 学んだ技術\n- node.jsでのサーバの書き方\n\n#### 工夫\n- ライブラリを使わないようにnodeのapiだけで作ってみた\n    - 使うときnpm installする必要がなくなって、シンプルなものになった\n- 普通に作ると起動時だけ設定ファイルを読むように作るが、フロントエンドの開発をしやすいようにリクエストの度に設定ファイルを読むようにした\n\n#### 改善点\n- typescript化\n- テストがない\n    - ルーティング定義のファイルを実行時引数で渡せるようにしないとな…\n- 公開ディレクトリに置かれたファイル（webpackなどのビルド成果物）の変更検知して、ブラウザをリロードしたい\n\n## [modal_sample](https://github.com/fourside/modal_sample)\n- よくあるモーダル画面のサンプル実装\n\n#### 背景\n- 仕事でモーダル画面が必要になったがライブラリを使わず実装したかった\n\n#### 学んだ技術\n- よくあるモーダルの実装方法\n    - 世の中のモーダルはどう実装されているのか、いろいろ調べてみるとだいたい同じだったのでそのように実装した\n- cssアニメーションの基礎\n\n#### 工夫\n- ライブラリを使わずvanillaに作ること\n- WindowsのインターネットオプションによってIEではlocalStorageが無効にできるので、Nullオブジェクトを用意した\n\n#### 改善点\n- 特になし\n\n## [elecron](https://github.com/fourside/elecron)\n- 指定したスケジュールで任意のURLを開く常駐アプリ\n\n#### 背景\n- 物理的な勤怠打刻からWebの打刻に移行した際、打刻を忘れてしまうという話を聞いた\n    - 出退勤の時間になったらブラウザで打刻用のサイトを開くアプリを作ろうと思った\n\n#### 学んだ技術\n- electron\n- vue\n- webpack\n\n#### 工夫\n- windows向けに作ったのでappveyorを使ってみた\n\n#### 改善点\n- cronの書式が分かりにくい（がパターンの表現力は高いので、完全に置き換えるものは思いつかず…）\n- コンポーネントが大きいので分割したい\n    - 1個のFormを分割するのは冗長な部分が増えそうで躊躇してしまう\n","childMarkdownRemark":{"excerpt":"今まで作ったものの説明をしてこなかったので簡単に説明しようと思います。 就職活動でGitHubのURLを乗せても、README…"}},"publishDate":"2019/08/13"}},{"node":{"title":"Java Day Tokyo 2018","slug":"javadaytokyo2018","body":{"body":"メールをプリントアウトして名刺と合わせて受付をするんだけど、メールに書いてある名前がメールアドレスのアカウントになっていて、名刺に載っている情報と全く一致せず、受付の人を困惑させてしまった。oracleアカウント、個人のやつだしね…。\n\nメモと感想です(後でスライドが公開されるだろうけど)。\n\n## key note\n- リリースモデルについて、わかりやすいけどOpenJDKはLTS出ないのね\n- jdk11が今年9月に出る(予定通り)\n    - JEPsはこれからも追加される\n- mission controll と flight recorder\n    - Eclipse pluginで開けて便利\n        - 下部のペインにスタックトレースからコードにジャンプできる\n    - パフォーマンスの問題3例での見え方\n        - LinkedListのループ内のget\n        - シングルトンインスタンス(ロガーとか)\n            - これどういうシチュエーションの問題だっけ\n        - ループ内でオートボクシングが発生しててGC走りまくってる\n            - 赤いアイコン出ないので問題なさそうに見えるので注意\n                - どう気づけばいいんだ？\n- リリース未定だったりする新しい機能\n    - Valhalla\n    - Portola\n    - Panama\n    - Amber\n    - Loom\n    - ZGC\n- fn\n    - サーバレス\n    - cli\n        - ボイラープレートを吐いたり\n        - ローカルサーバ起動できたり\n            - 個人的にこれがすごく良いと思う\n        - アプリをデプロイできたり\n    - javaで単一の処理で書けてしまうが、裏では複数のコンテナが実行されてるやつのデモ\n        - flickrから車の写真を集めてきて最終的にslackにポストしまくる\n\n## Java in a Wolrd of Containers\n- 翻訳レシーバの付け方がわからなくて英語で聞いてみたけどやっぱり翻訳必要だな…\n- jlink, jdeps\n- musl libc\n- portola\n- AppCDSでコンテナ間のクラスデータのシェア\n- Dockerの設定を考慮するJava起動オプションのサポート\n- 適切なbase imageを使うとサイズの軽量化できる\n\n## Project Valhalla\n- Value Types\n- Generics Specialization\n- Var Handles\n\n- 名前の由来\n    - Value Typesと似てるっしょ\n- シンタックス\n    - 例えばこんなの\n    - ```value class Hoge { } ```\n- クラスのように書けてプリミティブのように振る舞う\n    - ヘッダがない\n        - オブジェクトのメタ情報\n            - 何のインスタンスなのかとか\n    - モニタがない\n        - ロックの情報\n    - キャッシュミスしない\n        - これはどういう理屈だっけ…\n    - \"What Would Int Do\"\n- ジェネリクス\n    - どう扱えるの？\n    - `List<int> list = ...`\n- IntStreamとかToIntFunctionとかなくせる\n- クラスの継承ツリー\n    ```\n    -- any(仮)\n     |- primitive(int/long/...)\n     |- Object\n          | - ...\n    ```\n    - このany(仮)をバイトコードでどう表現するのとか悩んでるらしい\n- VarHandles\n    - Unsafeで扱えたメモリ操作ができる\n- 余談\n    - メモリバリア\n    - volatile\n        - この辺理解できてない\n\n## Curing you Domain Model Anemia...\n- DDDに触れてからのコードスメル\n    - フォーカスする話題の粒度が真逆というか振り幅がでかいというか\n- Martin Fowlerの\"When to make a type\"\n    - 疑問に思ったらクラスを作れ\n- ライブコーディング！\n    - githubやyoutubeにサンプルあるから探してくれ\n    - dddするときのモデルに特定のフレームワークを使っても(よい|ダメ)派がある\n        - 使ってもいい派\n        - 今回はjpaのエンティティをモデルとして扱う\n    - ex. 「primitiveなフィールド、マイナスにしたくない」\n        - オブジェクトにしちゃう\n            - イミュータブルにする\n                - コンストラクタはprivateにして、static factoryを作る\n                    - その中で引数の検査をする\n                - getterで参照を返すときはコピーを返そう\n            - hashcode/eqaulsの実装忘れずに\n            - toStringはデバッグ情報を出すようにすべき\n            - Formattable知ってる？\n                - ビジネス要件での出力\n                - 国際化するときも使える、詳しくはjavadoc\n    - ComparisonChain使ってたけどよく知らない、何がうれしいか調べておく\n    - enumコンストラクタはjava8での書き方があるらしい\n        - 今回は時間の都合でjava7のやり方（おなじみやつ）\n        - コードサンプル調べておく\n    - JPAでのtips\n        - イミュータブルなエンティティにするには\n            - コンストラクタはprotected\n        - フィールドにオブジェクトを持つ場合\n            - それがバリューオブジェクトだったら@ElementCollection\n            - エンティティだったらいつもの@OneToManyなど\n            - 件数が数件程度ならバリューオブジェクト、100件とかになったらエンティティにしたほうがよい\n\n## Get ready for a cloud native...\n- k8s + istio でコンテナのメトリクスを簡単に取得できる話\n- k8sで環境ごとのurlを用意しなくてよくなる\n    - アプリ側で使うのは論理的なURL\n- サイドカーコンテナ\n    - mainコンテナとproxyコンテナのセット\n- istio使うとgrafanaでモニタリングのダッシュボードが表示される\n- eclipse micro profile\n- server.xml\n- リクエストに関する設定(ルール)\n    - コネクションタイムアウト\n    - レスポンスのディレイ設定\n        - テストしやすくてよい！\n- リクエストヘッダにtrace-idみたいなのがついている\n    - これを追うとどのコンテナを通っていったか追跡できる\n- サーキットブレーカーという単語が出てきたけど、それが何だっていうところ聞き逃した…\n    - 言葉の意味は「一時的に止める措置」？\n\n```\nservice meshes: key takeaways\n- transparently add technical cross-cutting concerns.\n- think \"AOP for applications\"\n- routing, load-balancing, resiliency, telemetry, auth\n- integrates well with Java enterprise approach:\n    - business logic is responsibility of the applications\n    - technical concerns are part of the envioronment\n```\n\n### 全体的に\n- Cloudというかコンテナ周りというかにフォーカスされているのを確認した。\n- 面白かったのは新しい機能だったり普段の暮らしに近いコーディング周りだったり。\n    - DDDは座学な印象あるけど実地で見せてもらうと楽しい。\n","childMarkdownRemark":{"excerpt":"メールをプリントアウトして名刺と合わせて受付をするんだけど、メールに書いてある名前がメールアドレスのアカウントになっていて、名刺に載っている情報と全く一致せず、受付の人を困惑させてしまった。oracle…"}},"publishDate":"2018/05/17"}},{"node":{"title":"自己紹介ブログ","slug":"about-me","body":{"body":"職務経歴書に自己PRがないと指摘され、自分のよわみはすぐ書けるがつよみは書きにくい…と悩んだ末、自己紹介を書くことで代わりになるのでは、さらにブログの記事だったらより書きやすいはず、と思いました。\n\n1. プログラマーになろうと思ったきっかけ\n1. 好ましいと思っていること、大事にしたいこと\n\nこの辺が書ければ自己PRとしてもよいのでは。\n\n### プログラマーになろうと思ったきっかけ\n当時の僕は特に目指すものもなく派遣スタッフとして働いており、エクセルで住所データを加工する仕事をしていました。ショートカットキーを覚えてしまえばすぐ終わる仕事であったので、持て余した時間でVBAを覚えました。ここで初めてプログラミングの基礎を習得したのですが、新しいことを覚える楽しさ以外にも、高速化テクニックを試したり、他の言語ではどういう書き方をするのか調べたり（VBAは明らかに機能が少なく不自由だった）、学んだことがすぐ活かせるというのも面白く、なにより自分の書いたものが動くことは楽しい、原始的な喜びがあると気づきました。\n\nその職場では一応意味のあるものを作ることができて、それはエクセルブックから外字を検出するといったものでした（最終的に印字することが目的なので、事前に検出できることには意味がありました）。そのとき参考にしたのが「詳解正規表現」で（俗にいうところのフクロウ本）、初心者が読むにはちょっと難しかったんですが、体系的に知識を得るには（ちょっと背伸びしてでも）技術書というものを読むのが早いということを知りました。そんな感じで、こんな楽しいことが仕事になるんだったらいいなと次第に考えるようになりました。\n\nその頃、以下の記事を読んだのもその気になった原因のひとつと思います。\n\n- [プログラマになりたいあなたへの手紙 - プログラマになりたいあなたへ：ITpro](http://itpro.nikkeibp.co.jp/article/COLUMN/20090324/327115/?rt=nocnt)\n- [知らないと損する職業訓練 - phaの日記](http://pha.hateblo.jp/entry/20080429/1209464163)\n\nその後、職業訓練を経て、未経験OKな派遣業を営むSIerに拾ってもらうことができました。\n\n### 好ましいと思っていること、大事にしていること\nプログラマーとして働いていて気にしていることです。当たり前といえば当たり前のことではある。\n\n- テキストを好んで使うこと\n    - ドキュメントもインフラも何でもテキストで表現したらdiffも取れるしgitで管理できていいね、くらいの意味\n        - wordやエクセルで管理するのはウッと思う\n        - 人によってはマークダウンの書式が構造化された文書に見えないかもしれない（プレビューが必須だと面倒臭さが先に立ってしまう）\n- チーム全体で合意を取ること\n    - プロダクトは自分たちで作っていくという意識を持てる\n- ツールやWebサービスを取り入れること\n    - どんどん便利になっていきたい\n- 自動化\n    - どんどん便利になっていきたい\n    - 時間を生むので圧倒的に正しい\n        - 運用系のツールもどんどん取り入れたいのだけど、チームの合意がないまま使い始めるとつらいはずなので、おすすめしていく運動とセットだよなと思っている\n- 便利になること\n    - プログラマとしての使命だと思う\n- 名前付け\n    - Matzの「名前重要」の教えを念頭に\n    - クラス設計の第一歩と思っている\n        - この辺がgolang難しい（クラスがない、ファイル分割をどの単位でやっていいのかなど）\n- 目的を見失わないこと\n    - 議論が停滞したりちょっと逸れてきたなというとき「どうすれば勝ちなんだっけ」と言うことにしてる\n\n### 以上です\n的外れな感じになっていませんように…。\n","childMarkdownRemark":{"excerpt":"職務経歴書に自己PR…"}},"publishDate":"2018/01/29"}},{"node":{"title":"Jekyllのpostをvim scriptで作る","slug":"vim-script-jekyll","body":{"body":"### 問題\nJekyllでpost用のファイルを作るのがめんどくさい。\n- ファイル名が `yyyy-mm-dd-{title}.md`\n    - 数字やハイフンなんて打ちにくいところにあるのに…\n- お決まりのテンプレートを書かなくちゃいけない\n    - dateが特にめんどい\n    - こんなの\n```\n---\nlayout: post\ntitle: \"記事のタイトル\"\ndate: 2018-01-01 00:00:00 +0900\ncategories: vim\n---\n```\n\n### 解決方法\nvim pluginを探すと3つほどぱっと見つかるんだけど、欲しいものは簡単なものだし、自分でvim scriptを書いてみようと思った。\n\n### 欲しいもの\n- コマンドを実行するとバッファが開かれ、そこにテンプレートが展開される\n- コマンドは複数の引数を受け取ってハイフンでつなぎ、それが `yyyy-mm-dd-{title}.md` の `title` になる\n- 吐き出す場所はひとまずカレントディレクトリでいいや\n\n### 参考にしたもの\n- [Vimスクリプト基礎文法最速マスター - 永遠に未完成](http://thinca.hatenablog.com/entry/20100201/1265009821)\n    - 数年前にもvim script書こうと思い立ったことがあって、ヘルプよりこっちを見てしまう\n- [vim-jp » Vim script事始め](http://vim-jp.org/tips/start_vimscript.html)\n    - `:h write-plugin` が丁寧でvimはドキュメントしっかりしてるな～と思った\n    - `q-args` というのを初めて知った。 `args` だとコマンドの引数を文字列として扱ってくれないので不便だなあと悩んでいた。\n    - プラグインの2重ロードを防ぐイディオム、開発のとき邪魔だからコメントアウトしてたんだけど、うっかりコミットしそう\n        - 何回でもロードしていいように書くのが正解なのかな\n- [Vimスクリプトを書いてみよう — KaoriYa](https://www.kaoriya.net/blog/2012/02/19/)\n    - わかりやすい\n- 自分のvimrc\n    - 普段のメモを取るように、日付をファイル名にしたバッファを開くコマンドを作っていたのだった\n    - それもどこからかコピーして持ってきたやつだったはず…\n\n### できたもの\n長いので折りたたみたい…\n\n`gist:fourside/d09cbf3a755e292e977e31e592a7ee09`\n\n### はまったところ\n- 可変長引数をjoinすると、デリミタが無視されてスペースで連結されてしまう\n    - 仕方なく、joinしてsplitしてjoinした…\n- strftime('%z')から `+0900` みたいなタイムゾーンのオフセットを得たいのだけど、Windowsだと `東京（標準時）` が返ってきてしまう。\n    - [strftime(\"%z\") not working correctly · Issue #860 · vim/vim](https://github.com/vim/vim/issues/860)\n    - 仕方ないっぽいので、Windowsでは `+0900` 固定にした。自分用だし。\n","childMarkdownRemark":{"excerpt":"問題 Jekyllでpost用のファイルを作るのがめんどくさい。 ファイル名が  数字やハイフンなんて打ちにくいところにあるのに… お決まりのテンプレートを書かなくちゃいけない dateが特にめんどい こんなの 解決方法 vim pluginを探すと…"}},"publishDate":"2017/12/31"}},{"node":{"title":"blog 環境","slug":"github_pages_jekyll","body":{"body":"今までメモはローカルに溜めていて、マシンの買い替えなんかが起きるとめんどくさくて、そのせいでDropboxが必須になってしまっていたり、自宅でやったことを職場で確認したいだとかは基本的に困難なので、ブログとして公開することにした。\n\n### 構成要素と理由\n\n- [GitHub Pages][GitHub Pages]\n- [jekyll][jekyll]\n- on WSL\n\nはてなやMediumでもよいんだろうけどソーシャルな機能はいらないし、tech系の話だったらgithubアカウント上でやったほうがいいかな程度の理由。テキストが手元に残るのもよい。\n\nあと最近、自宅のマシンをWindows10にしたこともあって、WSLだったらWindows上でrubyの開発環境を整えることに苦労しなくなると思った。cmd.exeからbashと打つだけでlinuxの世界になるのはすごい楽。ただrubyのビルドにえらい時間がかかったので途中で諦め、パッケージマネージャからインストールすることにした。バージョンはちょい古めだけど、nokogiriがすんなり入るのはうれしい。\n\n### 手順\n```\n$ sudo apt-get install ruby ruby-dev zlib1g-dev\n$ ruby -v\nruby 2.3.1p112 (2016-04-26) [x86_64-linux-gnu]\n$ gem install jekyll jekyll-feed minima\n$ jekyll -v\njekyll 3.6.2\n$ jekyll new fourside.github.io\n```\n\nzlibの1gってなんだろうね。\n\n### はまりどころ(未解決)\nWSL(Ubuntu)でrootだと日本語が表示できない。標準ユーザだとできる。envコマンドの差分を見たけど影響しそうなところがないように見える。どこに差があるのか分からない。ターミナルに弱い。\n\n### めんどくさいところ\npostするときにいっぱつでテンプレートを開きたい。ファイル名`yyyy-mm-dd-{title}.md`なんて手で打ちたくないし、ファイルの中身に作成日時まで入れなくちゃいけない。jekyllのコマンドにあってよさそうだけど、ぱっと見ない。\n\nvim pluginを探すか、これくらいなら自分で作ってみようかなという気持ちになっている。\n\n[GitHub Pages]: https://pages.github.com/\n[jekyll]: https://jekyllrb-ja.github.io/\n","childMarkdownRemark":{"excerpt":"今までメモはローカルに溜めていて、マシンの買い替えなんかが起きるとめんどくさくて、そのせいでDropboxが必須になってしまっていたり、自宅でやったことを職場で確認したいだとかは基本的に困難なので、ブログとして公開することにした。 構成要素と理由 GitHub Pages…"}},"publishDate":"2017/12/31"}},{"node":{"title":"radiko 録音環境","slug":"radiko_infra","body":{"body":"さくらVPSを借りてradikoの録音環境を用意していたんだけど、今年の4月くらいから録音ができなくなっていた。今更だけど確認してみると、`curl https://radiko.jp/area` がOSAKAになってたので、東京の放送局が聴取できない状態だった。radikoの仕様変更じゃなかったので一安心。\n\nまずawsの東京リージョンでt2.microインスタンスを作った。OSはamazon linux。radikoのエリア判定はTOKYOだったのでこれでよし。鍵はawsが生成したもの、インバウンドはsshとhttpのみ、さらにマイIPアドレスから許可するように、screenとvimのrcファイルを用意した。\n\nあとは必要なものをビルドするだけ。\n\n### 必要なもの\n\n- [rtmpdump][rtmpdump]\n- [swftools][swftools]\n- [ffmpeg][ffmpeg]\n\n### 前準備\n```bash\nyum install git\nyum groupinstall \"Development Tools\"\n```\n\n### rtmpdump\nオフィシャルの通り、`git clone git://git.ffmpeg.org/rtmpdump` する。READMEを見るとconfigureしなくてよいみたい。`make SYS=posix && make install`した。\n\n```\n# rtmpdump -v\nrtmpdump: error while loading shared libraries: librtmp.so.1: cannot open shared object file: No such file or directory\n```\n\nsoが読めてないっぽい。ビルドしたsoは`/usr/local/lib`にインストールされてる。\n\n```\n# cat /etc/ld.so.conf\ninclude ld.so.conf.d/.conf\n# echo /usr/local/lib > /etc/ld.so.conf.d/rtmpdump.conf\n# ldconfig\n```\ncf. https://blogs.yahoo.co.jp/mrsd_tangerine/40359620.html\n\n### swftools\n最新のtarballを落としてくる。configure, make, make installですんなりいけた。(さくらVPSで使ってたdebianでは苦労した印象あったけど曖昧）\n\n### ffmpeg\nすっかり忘れてたんだけど旧環境ではlameを使ってて、それをconfigure時に指定してやる必要がある。（指定しなくてもビルドはできるけど、ここでやりたいのはflvからmp3にエンコードすることなので）\n\n[lame][lame]から落としてくる。configure, make, make installですんなりビルドできる。soは/usr/local/libに吐かれる。\nこのあとffmpegのビルド。\n```\n# configure --enable-libmp3lame --disable-x86asm\n# make\n# make install\n```\n\n### 以上\nこんな感じでした。\n\n[rtmpdump]: https://rtmpdump.mplayerhq.hu/\n[swftools]: http://www.swftools.org/download.html\n[ffmpeg]: https://www.ffmpeg.org/download.html\n[lame]: http://lame.sourceforge.net/download.php\n","childMarkdownRemark":{"excerpt":"さくらVPSを借りてradikoの録音環境を用意していたんだけど、今年の4月くらいから録音ができなくなっていた。今更だけど確認してみると、 がOSAKAになってたので、東京の放送局が聴取できない状態だった。radikoの仕様変更じゃなかったので一安心。 まずaws…"}},"publishDate":"2017/12/30"}}]}},"pageContext":{}},
    "staticQueryHashes": ["2390137347","3000541721"]}